<!DOCTYPE html>
<html lang="uz">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>4 Player Chess - Safarbek</title>
    <style>
        body { background: #2c3e50; color: white; margin: 0; display: flex; flex-direction: column; align-items: center; justify-content: center; height: 100vh; font-family: 'Segoe UI', sans-serif; overflow: hidden; }
        #ui { margin-bottom: 15px; padding: 10px 25px; background: #2ecc71; border-radius: 8px; font-size: 22px; font-weight: bold; text-transform: uppercase; box-shadow: 0 4px 6px rgba(0,0,0,0.3); transition: 0.3s; }
        #board { display: grid; grid-template-columns: repeat(14, 1fr); width: 95vw; max-width: 550px; aspect-ratio: 1 / 1; border: 5px solid #34495e; background: #34495e; box-shadow: 0 10px 25px rgba(0,0,0,0.5); }
        .cell { width: 100%; height: 100%; display: flex; justify-content: center; align-items: center; cursor: pointer; font-size: 6.5vw; user-select: none; -webkit-tap-highlight-color: transparent; }
        @media (min-width: 550px) { .cell { font-size: 35px; } }
        .white { background: #ecf0f1; } .black { background: #bdc3c7; }
        .empty { visibility: hidden; } .selected { background: #f1c40f !important; border: 2px solid white inset; }
        /* Jamoalar Ranglari */
        .p-green { color: #27ae60; } .p-red { color: #e74c3c; }
        .p-yellow { color: #f1c40f; } .p-blue { color: #3498db; }
    </style>
</head>
<body>
    <div id="ui">NAVBAT: <span id="turn-display">GREEN</span></div>
    <div id="board"></div>

<script>
    const turnUI = document.getElementById('ui');
    const turnDisplay = document.getElementById('turn-display');
    const turns = ["Green", "Red", "Yellow", "Blue"];
    const turnColors = {"Green": "#2ecc71", "Red": "#e74c3c", "Yellow": "#f1c40f", "Blue": "#3498db"};
    let currentTurnIndex = 0;
    let selectedID = null;

    function initBoard() {
        const board = document.getElementById('board');
        board.innerHTML = "";
        for(let r=0; r<14; r++) {
            for(let c=0; c<14; c++) {
                const cell = document.createElement('div');
                cell.id = `r${r}c${c}`;
                cell.className = 'cell ' + ((r+c)%2==0?'white':'black');
                if((r<3||r>10)&&(c<3||c>10)) cell.classList.add('empty');
                cell.onclick = () => onCellClick(cell.id);
                board.appendChild(cell);
            }
        }
        setupAllPieces();
    }

    function setupAllPieces() {
        const mainSet = ['♖','♘','♗','♕','♔','♗','♘','♖'];
        // 1. YASHIL (Past)
        for(let i=0; i<8; i++) {
            setPiece(13, 3+i, mainSet[i], 'p-green');
            setPiece(12, 3+i, '♙', 'p-green');
        }
        // 2. QIZIL (Tepa)
        for(let i=0; i<8; i++) {
            setPiece(0, 3+i, mainSet[i], 'p-red');
            setPiece(1, 3+i, '♟', 'p-red');
        }
        // 3. SARIQ (Chap)
        for(let i=0; i<8; i++) {
            setPiece(3+i, 0, mainSet[i], 'p-yellow');
            setPiece(3+i, 1, '♟', 'p-yellow');
        }
        // 4. MOVIY (O'ng)
        for(let i=0; i<8; i++) {
            setPiece(3+i, 13, mainSet[i], 'p-blue');
            setPiece(3+i, 12, '♙', 'p-blue');
        }
    }

    function setPiece(r, c, char, cls) {
        const el = document.getElementById(`r${r}c${c}`);
        el.innerText = char;
        el.classList.add(cls);
    }

    function onCellClick(id) {
        const cell = document.getElementById(id);
        if(!selectedID) {
            if(cell.innerText !== "") {
                selectedID = id;
                cell.classList.add('selected');
            }
        } else {
            const from = document.getElementById(selectedID);
            if(from.id === id) { // Bekor qilish
                from.classList.remove('selected');
                selectedID = null;
                return;
            }
            
            cell.innerText = from.innerText;
            cell.className = from.className; 
            cell.classList.remove('selected');
            from.innerText = "";
            const [r, c] = selectedID.match(/\d+/g).map(Number);
            from.className = 'cell ' + ((r+c)%2==0?'white':'black');
            
            selectedID = null;
            
            // Navbatni almashtirish
            currentTurnIndex = (currentTurnIndex + 1) % 4;
            const next = turns[currentTurnIndex];
            turnDisplay.innerText = next;
            turnUI.style.backgroundColor = turnColors[next];
        }
    }

    initBoard();
</script>
</body>
</html>
